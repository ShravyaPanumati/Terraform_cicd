steps:
# Step 1: Initialize Terraform
- name: 'hashicorp/terraform'
  args: ['init']

# Step 2: Plan Terraform deployment
- name: 'hashicorp/terraform'
  args: ['plan', '-var', 'project_id=$PROJECT_ID', '-var', 'region=$REGION']
  env:
  - 'PROJECT_ID=your-gcp-project-id'
  - 'REGION=us-central1'

# Step 3: Apply Terraform changes
- name: 'hashicorp/terraform'
  args: ['apply', '-auto-approve', '-var', 'project_id=$PROJECT_ID', '-var', 'region=$REGION']
  env:
  - 'PROJECT_ID=strategic-reef-435523-j1'
  - 'REGION=us-central1'

# Step 4: Install Python dependencies and run Flask app
- name: 'gcr.io/cloud-builders/python'
  entrypoint: 'sh'
  args:
    - '-c'
    - |
      pip install -r requirements.txt
      python app/run.py

timeout: 1200s # Set timeout for the build process
options:
  logging: GCS_ONLY # Log only to GCS
logsBucket: gs://todo-app-build-logs-strategic-reef-435523 # Specify the logs bucket
